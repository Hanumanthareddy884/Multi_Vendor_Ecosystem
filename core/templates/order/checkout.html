{% extends 'home.html' %}

{% block content %}
    <h1>Checkout</h1>
    <form id="payment-form">
        <input type="text" id="first_name" placeholder="First Name" required><br>
        <input type="text" id="last_name" placeholder="Last Name" required><br>
        <input type="email" id="email" placeholder="Email" required><br>
        <input type="text" id="address" placeholder="Address" required><br>
        <input type="text" id="zipcode" placeholder="Zipcode" required><br>
        <input type="text" id="place" placeholder="City" required><br>

        <button type="button" id="checkout-button">Pay with Stripe</button>
    </form>

    <script src="https://js.stripe.com/v3/"></script>
    <script>
        var stripe = Stripe('{{ pub_key }}');
        var checkoutButton = document.getElementById('checkout-button');

        checkoutButton.addEventListener('click', function() {
            // Collect form data
            const formData = {
                first_name: document.getElementById('first_name').value,
                last_name: document.getElementById('last_name').value,
                email: document.getElementById('email').value,
                address: document.getElementById('address').value,
                zipcode: document.getElementById('zipcode').value,
                place: document.getElementById('place').value,
            };

            // Send data to Django
            fetch('{% url "create_checkout_session" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}',
                },
                body: JSON.stringify(formData) // This sends the form data to the view
            })
            .then(response => response.json())
            .then(session => {
                return stripe.redirectToCheckout({ sessionId: session.id });
            })
            .catch(error => console.error('Error:', error));
        });
    </script>
{% endblock %}