{% extends 'home.html' %}

{% block content %}
    <h1>Checkout</h1>

    <form method="post" action=".">
        {% csrf_token %}
        <h3>Shipping Information</h3>
        <input type="text" name="first_name" placeholder="First Name" required><br>
        <input type="text" name="last_name" placeholder="Last Name" required><br>
        <input type="email" name="email" placeholder="Email" required><br>
        <input type="text" name="address" placeholder="Address" required><br>
        <input type="text" name="zipcode" placeholder="Zipcode" required><br>
        <input type="text" name="place" placeholder="City" required><br>
        
        <hr>
        <h3>Total to pay: ${{ cart.get_total_cost }}</h3>
        <button type="submit" style="background: green; color: white; padding: 10px;">Place Order</button>
    </form>
{% endblock %}
<script src="https://js.stripe.com/v3/"></script>

<script>
    var stripe = Stripe('{{ settings.STRIPE_PUB_KEY }}');
    var checkoutButton = document.getElementById('checkout-button');

    checkoutButton.addEventListener('click', function() {
        fetch('{% url "create_checkout_session" %}', {
            method: 'POST',
            headers: {'X-CSRFToken': '{{ csrf_token }}'}
        })
        .then(function(response) { return response.json(); })
        .then(function(session) { return stripe.redirectToCheckout({ sessionId: session.id }); });
    });
</script>